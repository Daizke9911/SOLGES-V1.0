services:
  - type: pserv # (CAMBIO) El tipo es 'pserv' (Servicio Privado)
    name: proyecto_solges_2025 # (El nombre sigue igual)
    region: oregon
    runtime: docker # (CAMBIO) Le decimos que use Docker
    image:
      url: mysql:8.0 # (CAMBIO) Usamos la imagen oficial de MySQL v8

    # (CAMBIO) ¡MUY IMPORTANTE! Añadimos un disco para guardar los datos
    disks:
      - name: mysql-data # Nombre del disco
        mountPath: /var/lib/mysql # Ruta donde MySQL guarda datos
        sizeGB: 1 # Tamaño del disco (puedes empezar con 1GB)
        
    # (CAMBIO) Variables para configurar el contenedor de MySQL
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        generateValue: true # Render creará una contraseña segura
      - key: MYSQL_DATABASE
        value: sistema_solges_2025 # Elige el nombre de tu base de datos
      - key: MYSQL_USER
        value: root # Elige tu usuario
      - key: MYSQL_PASSWORD
        generateValue: true # Render creará una contraseña segura

  # Caché con Redis (Sin cambios, recomendado para Livewire)
  - type: redis
    name: mi-cache
    region: oregon
    plan: free

  # Aplicación Web (Laravel)
  - type: web
    name: mi-app
    region: oregon
    runtime: php
    plan: free
    
    # Comandos de construcción (Sin cambios)
    buildCommand: |
      composer install --no-dev --optimize-autoloader
      npm install
      npm run build
      php artisan config:cache
      php artisan route:cache
      php artisan view:cache
      php artisan migrate --force
      
    startCommand: php artisan serve --host 0.0.0.0 --port ${PORT}
    
    envVars:
      - key: APP_URL
        value: ${RENDER_EXTERNAL_URL}
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false
      # (Recuerda añadir tu APP_KEY manualmente en el Dashboard)
      
      # --- CAMBIO 2: Conectar Laravel al nuevo servicio MySQL ---
      # Ya no usamos DATABASE_URL, usamos las variables estándar de Laravel
      - key: DB_CONNECTION
        value: mysql
      - key: DB_HOST
        fromService:
          type: pserv # (CAMBIO) Apuntamos al 'pserv'
          name: proyecto_solges_2025 # (CAMBIO) El nombre de nuestro servicio MySQL
          property: host
      - key: DB_PORT
        fromService:
          type: pserv
          name: proyecto_solges_2025
          property: port
      - key: DB_DATABASE # Leemos la variable del servicio MySQL
        fromService:
          type: pserv
          name: proyecto_solges_2025
          envVarKey: MYSQL_DATABASE # (CAMBIO) Coincide con la clave de arriba
      - key: DB_USERNAME # Leemos la variable del servicio MySQL
        fromService:
          type: pserv
          name: proyecto_solges_2025
          envVarKey: MYSQL_USER # (CAMBIO) Coincide con la clave de arriba
      - key: DB_PASSWORD # Leemos la variable del servicio MySQL
        fromService:
          type: pserv
          name: proyecto_solges_2025
          envVarKey: MYSQL_PASSWORD # (CAMBIO) Coincide con la clave de arriba
          
      # Conexión a Redis (Sin cambios)
      - key: SESSION_DRIVER
        value: redis
      - key: CACHE_DRIVER
        value: redis
      - key: REDIS_HOST
        fromService:
          type: redis
          name: mi-cache
          property: host
      - key: REDIS_PORT
        fromService:
          type: redis
          name: mi-cache
          property: port